apiVersion: forge.dominodatalab.com/v1alpha1
kind: ContainerImageBuild
metadata:
  name: build-init-container-sample
spec:
  imageName: init-container-sample
  context: https://raw.githubusercontent.com/dominodatalab/forge/master/test/data/test-init-container.tar.gz
  pushTo:
    - docker-registry:5000
  registries:
    - server: docker-registry:5000
      nonSSL: true
      basicAuth:
        secretName: docker-registry-auth
        secretNamespace: default
  initContainers:
    - name: "test-init"
      image: "busybox"
      command: ["/bin/sh"]
      args:
        - "-c"
        - "mkdir -p $TARGET_DIR && echo $MESSAGE > $TARGET_DIR/init-container-generated.txt"
      env:
        - name: MESSAGE
          value: "File generated by init container"
        - name: TARGET_DIR
          value: "extracted/files/app"
