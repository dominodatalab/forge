apiVersion: forge.dominodatalab.com/v1alpha1
kind: ContainerImageBuild
metadata:
  name: test-init-container
spec:
  imageName: init-container-files
  context: https://forge-builder-test.s3-us-west-2.amazonaws.com/test-init-container.tar.gz
  disableBuildCache: true
  pushTo:
    - docker-registry-2:5000
  registries:
    - server: docker-registry-2:5000
      nonSSL: true
      basicAuth:
        username: marge
        password: simpson
  initContainers:
    - name: "test-init"
      image: "busybox"
      command: ["/bin/sh"]
      args:
        - "-c"
        - "mkdir -p $TARGET_DIR && echo $MESSAGE > $TARGET_DIR/init-container-generated.txt"
      env:
        - name: MESSAGE
          value: "File generated by init container"
        - name: TARGET_DIR
          value: "extracted/files/app"
