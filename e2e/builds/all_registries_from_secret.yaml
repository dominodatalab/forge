apiVersion: forge.dominodatalab.com/v1alpha1
kind: ContainerImageBuild
metadata:
  name: test-all-registries-from-secret
spec:
  imageName: all-registries-from-secret-app
  context: https://forge-builder-test.s3-us-west-2.amazonaws.com/variable-base-app.tgz
  disableBuildCache: true
  buildArgs:
    - base=docker-registry:5000/simple-app:latest
  pushTo:
    - docker-registry-2:5000
  registries:
    # The explicit assert here is for second-docker-registry
    # but the push above is to docker-registry (also contained
    # in the dockerconfig.json in the secret). This will only work
    # if all the auth entries from the secret are correctly loaded.
    - server: docker-registry-2:5000
      nonSSL: true
      basicAuth:
        secretName: docker-registry-auth
        secretNamespace: ${TEST_NS}
